#!/bin/bash

# reencode all files in the dir

du -H -c . | tail -n1 | cut -f 1

START=$(du -c . | tail -n1 | cut -f 1)

if [[ "$1" == "-d" ]] ; then
    DRYRUN="echo"
else
    DRYRUN=""
fi

echo "" > remove

for infile in * ; do
    case "$infile" in
        *reencode*) ;;
        *.avi | *.mkv | *.mp4)
            reencode-file $@ "$infile"
            ;;
    esac
done && \
$DRYRUN rm -f *.nfo && \
$DRYRUN rm -rf '.@__thumb' && \
for x in * ; do
    case "$x" in
        *reencode*) ;;
        *.mkv | *.avi | *.mp4)
            echo "\rm -f \"${x}\"" | grep -v reencode >> remove
            ;;
    esac
done

echo "\rm -f remove" >> remove

END=$(du -c . | tail -n1 | cut -f 1)

echo "(${END}-${START}) / ${START}" | bc -l
